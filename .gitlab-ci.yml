stages:
  - build

install-licensight-file:
  stage: build
  script:
    - echo "install licensight-file"
    - curl -O https://licensight.s3.eu-central-1.amazonaws.com/test/licensight-scan
    - chmod +x ./licensight-file
  rules:
    - if: '$CI_MERGE_REQUEST_IID'

build-licensight-scan-without-access-token:
  image: maven:3.8-openjdk-11
  stage: build
  script:
    - ./licensight-scan generate -d . -a $PROJECT_NAME -e $ENV -at $SECRET_KEY -dpr -b $CI_COMMIT_REF_NAME
  rules:
    - if: '$CI_MERGE_REQUEST_IID'

build-licensight-scan-with-access-token:
  stage: build
  variables:
    GITLAB_TOKEN: $GITLAB_ACCESS_TOKEN
  script:
    - ./licensight-scan generate -d . -a $PROJECT_NAME -e $ENV -at $SECRET_KEY -dpr -b $CI_COMMIT_REF_NAME
  rules:
    - if: '$CI_MERGE_REQUEST_IID'

build-licensight-scan-with-gat:
  stage: build
  variables:
    GITLAB_TOKEN: $GITLAB_ACCESS_TOKEN
  script:
    - ./licensight-scan generate -d . -a $PROJECT_NAME -e $ENV -at $SECRET_KEY -dpr gat $GITLAB_ACCESS_TOKEN -b $CI_COMMIT_REF_NAME
  rules:
    - if: '$CI_MERGE_REQUEST_IID'